<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>GFW blocks the rendering of page</title>
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>

      <header>
        <h1>GFW blocks the rendering of page</h1>
        <p><p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="../" class="button fork"><strong>GitHublog</strong></a>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>Summary</h1>
		<hr>
		<!--<p>Today more and more persons and organizations are focusing on improving web performance. One of the most important benchmark is <a href="http://developer.yahoo.com/performance/rules.html">rules for high performance web pages</a> which are summarized by Yahoo web performance team. Rule #6 ”<em>Put scripts at bottom</em>” is the one we couldn’t be more familiar with.  But ironically, many website, even whose advocate for high web performance, go against with this rule, and cause fatal errors in certain circumstances.
		</p>-->
		<p>
			Today more and more people and organizations are focusing on improving web performance. One of the most important benchmark is <a href="http://developer.yahoo.com/performance/rules.html" target="_blank">rules for high performance web pages</a>, which are summarized by Yahoo web performance team. Rule #6 <em>“Put scripts at the bottom”</em> is the one we couldn’t be more familiar with. But ironically, many websites, even who advocate for high web performance, go against with this rule, and cause fatal experience defect in certain circumstances.
		</p>
        <h1>Real Cases</h1>
		<hr>
		<p>
			Let’s take a look at <a href="http://www.webperformancetoday.com/" target="_blank">Web Performance Today</a> first. The <a href="http://www.webperformancetoday.com/about/" target="_blank">author of this blog</a> likes to <em>“explore the issues around optimization and to analyze the impact of website speed on user behaviour”</em>. But I bet he never tried to visit his own website from a particular country -- <strong>mainland China</strong>. If he did, he will see this instead: 
		</p>
		<p class="image">
			<a href="images/performance-today-blocked-by-twitter-large.png" target="_blank"><img src="images/performance-today-blocked-by-twitter.png" height="" /></a>
		</p>
		<p>
			What did you see? The request of <a href="http://platform.twitter.com/widgets.js" target="_blank">widgets.js</a> from Twitter is pended, cause a 4.39 seconds blocking at least when rendering this page. During this period, visitors can see nothing but only the title in the first screen. That is unacceptable for visitors, especially for guys who advocate to web performance.
		</p>
		<p>
			If you have enough patience, you will get all stuff downloaded (or failed downloaded) after <strong>6.3 minutes</strong>. <strong>The onload time of the page is 5 minutes</strong>. Also, you may notice that several javascript files could not be downloaded eventually, which are all hosted by Google, Facebook or Twitter.
		</p>
		<p class="image">
			<a href="images/performance-today-waterfall-large.png" target="_blank"><img src="images/performance-today-waterfall.png" height="" /></a>
		</p>
		<p>
			This type of error can be found easily in many websites, even <a href="http://www.yottaa.com/about/yottaa-overview/" target="_blank">Yottaa</a>, a “<em>all-in-one web optimization solution</em>” that “<em>delivers speed, scale, security and actionable insight for any website</em>”, has the similar problem too. Page rendering is blocked for at least 22 seconds, which is a really long time because of loading the same widgets.js. <a href="http://www.yottaa.com/blog/bid/271932/Why-Your-Website-Is-Slow-Poor-First-Last-Byte-Performance" target="_blank">Why Your Website is Slow?</a> Yottaa should resolve his own problem first.
		</p>
		<p class="image">
			<a href="images/yottaa-performance-fail-large.png" target="_blank"><img src="images/yottaa-performance-fail.png" height="" /></a>
		</p>
        <h1>Why This Happened</h1>
		<hr>
		<p>
			Many website, usually blogs, are willing to provide share buttons on the page so that visitors can easily share the post with their friends on other SNS websites (google, facebook, twitter, etc...). For realizing this "share" function, some javascript snippets need to be embedded into the page. But the location of where they are embedded matters. A wiser programmer will put them at the bottom of the page, while some others always ignore this key point, which may lead to a experience disaster as described above.
		</p>
		<p>
			Why bottom is wiser? The apparent reason is, if the external javascript file is located at the top or middle of the page, once the downloading occurred with problems (such as long DNS lookup time, long connection time, long server response time, etc.) , they block the rest of page from rendering. Further reason is, in China, the  <a href="http://en.wikipedia.org/wiki/Great_Firewall_of_China" target="_blank">Great FireWall ( aka GFW )</a> controls the Internet data flow, and cause unexpected connection failure when fetching resources from certain website like google, twitter, facebook etc. We will have a further discussion on this later.
		</p>
        <h1>Conclusion</h1>
		<hr>
		<p>
			All in all above, I just want to appeal for web developers all over the world, please <a href="http://developer.yahoo.com/performance/rules.html#js_bottom" target="_blank"><em>Put scripts at the bottom</em></a> so that Chinese netizens can browse your sites with less suffering.
		</p>
		<p>
			<blockquote>
				Anything that can go wrong, will go wrong.<br>
				-- <a href="http://en.wikipedia.org/wiki/Murphy's_law" target="_blank">Murphy’s Law</a> --
			</blockquote>
		</p>
		<p>
			Thank you for reading.
		</p>
        <h1>Comments</h1>
		<hr>
		<p><a href="https://github.com/AndreLion/blog/issues/1">Leave a Comment -&gt;</a></p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://twitter.com/AndreLion">AndreLion</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="../javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-39563712-1', 'github.com');
	  ga('send', 'pageview');

	</script>
  </body>
</html>